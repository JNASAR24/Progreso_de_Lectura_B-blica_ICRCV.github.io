<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <link rel="icon" type="image/svg+xml" href="LogoICRCV.png">
  <link rel="icon" type="image/png" href="LogoICRCV.png" sizes="32x32">
  <link rel="apple-touch-icon" href="LogoICRCV.png" sizes="180x180">
  <title>Iglesia Cristiana Reformada Cristo Viene</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: linear-gradient(to right, #42af62, #ffffff, #42af62);
      color: #000;
    }
    h1 { text-align: center; font-size: 1.8rem; }
    h2 { text-align: center; font-size: 1.2rem; }
    h6 {
      color: #8f9797;
      text-align: left;
    }
    .container {
      max-width: 600px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .progress-container { margin-top: 15px; padding: 12px; border: 1px solid #ddd; border-radius: 8px; background: #fafafa; }
    .progress-bar { height: 20px; background: #ddd; border-radius: 10px; overflow: hidden; margin-top: 10px; }
    .progress-fill { height: 100%; background: linear-gradient(to right, #f00, #0f0); width: 0%; transition: width 0.5s; }
    .hermano { margin-bottom: 15px; padding: 10px; border-bottom: 1px solid #ccc; }
    button { margin-top: 5px; padding: 8px 12px; border: none; border-radius: 5px; cursor: pointer; font-size: 0.9rem; }
    .add-btn { background: #007BFF; color: white; }
    .delete-btn { background: #dc3545; color: white; }
    .save-btn { background: #28a745; color: white; }
    .dark-btn { background: #333; color: white; float: right; }
    input, select { padding: 8px; margin-top: 5px; width: 100%; font-size: 0.9rem; }
    body.dark { background: #121212; color: #eee; }
    body.dark .container { background: #1e1e1e; color: #eee; }
    body.dark .progress-container { background: #2a2a2a; border: 1px solid #444; }
    body.dark .progress-bar { background: #444; }
  </style>
</head>
<body>
  <h6>v 1.2.0</h6>
  <div class="container">
    <h1>Iglesia Cristiana Reformada Cristo Viene</h1>
    <h2>ðŸ“– Progreso de Lectura BÃ­blica</h2>
    <button class="dark-btn" onclick="toggleDarkMode()">ðŸŒ™ Modo Oscuro</button>

    <h3>AÃ±adir Hermano</h3>
    <input type="text" id="nombreHermano" placeholder="Nombre del hermano">
    <button class="add-btn" onclick="agregarHermano()">âž• Agregar</button>

    <div id="hermanosList"></div>
  </div>

  <script>
    // Toggle Dark Mode
    function toggleDarkMode() {
      document.body.classList.toggle("dark");
      localStorage.setItem("darkMode", document.body.classList.contains("dark"));
    }
    if (localStorage.getItem("darkMode") === "true") {
      document.body.classList.add("dark");
    }

    // Libros de la Biblia con capÃ­tulos
    const libros = {
      "GÃ©nesis": 50, "Ã‰xodo": 40, "LevÃ­tico": 27, "NÃºmeros": 36, "Deuteronomio": 34,
      "JosuÃ©": 24, "Jueces": 21, "Rut": 4, "1 Samuel": 31, "2 Samuel": 24,
      "1 Reyes": 22, "2 Reyes": 25, "1 CrÃ³nicas": 29, "2 CrÃ³nicas": 36,
      "Esdras": 10, "NehemÃ­as": 13, "Ester": 10, "Job": 42, "Salmos": 150,
      "Proverbios": 31, "EclesiastÃ©s": 12, "Cantares": 8, "IsaÃ­as": 66,
      "JeremÃ­as": 52, "Lamentaciones": 5, "Ezequiel": 48, "Daniel": 12,
      "Oseas": 14, "Joel": 3, "AmÃ³s": 9, "AbdÃ­as": 1, "JonÃ¡s": 4,
      "Miqueas": 7, "NahÃºm": 3, "Habacuc": 3, "SofonÃ­as": 3,
      "Hageo": 2, "ZacarÃ­as": 14, "MalaquÃ­as": 4,
      "Mateo": 28, "Marcos": 16, "Lucas": 24, "Juan": 21,
      "Hechos": 28, "Romanos": 16, "1 Corintios": 16, "2 Corintios": 13,
      "GÃ¡latas": 6, "Efesios": 6, "Filipenses": 4, "Colosenses": 4,
      "1 Tesalonicenses": 5, "2 Tesalonicenses": 3,
      "1 Timoteo": 6, "2 Timoteo": 4, "Tito": 3, "FilemÃ³n": 1,
      "Hebreos": 13, "Santiago": 5, "1 Pedro": 5, "2 Pedro": 3,
      "1 Juan": 5, "2 Juan": 1, "3 Juan": 1, "Judas": 1,
      "Apocalipsis": 22
    };

    const totalCapitulos = Object.values(libros).reduce((a,b) => a+b,0); 
    let hermanos = JSON.parse(localStorage.getItem("hermanos")) || [];

    function guardarLocalStorage() {
      localStorage.setItem("hermanos", JSON.stringify(hermanos));
    }

    function agregarHermano() {
      const nombre = document.getElementById("nombreHermano").value.trim();
      if (nombre && !hermanos.some(h => h.nombre === nombre)) {
        hermanos.push({ nombre, libro: "GÃ©nesis", capitulo: 1 });
        guardarLocalStorage();
        renderHermanos();
      }
      document.getElementById("nombreHermano").value = "";
    }

    function eliminarHermano(index) {
      hermanos.splice(index, 1);
      guardarLocalStorage();
      renderHermanos();
    }

    function guardarProgreso(index) {
      const libro = document.getElementById(`libro-${index}`).value;
      const capitulo = parseInt(document.getElementById(`capitulo-${index}`).value) || 1;
      hermanos[index].libro = libro;
      hermanos[index].capitulo = capitulo;
      guardarLocalStorage();
      renderHermanos();

      //Enviar datos a Google Sheets
      const { porcentaje } = calcularProgreso(libro, capitulo);
      fetch("https://script.google.com/macros/s/AKfycbxQZAS0j946bCHZk9zt0BL-CbWKwlwo7y2S9z10B5o7hVm9kZBoL35gVqgdZIqBPFpKLQ/exec", { 
        body: JSON.stringify({
          nombre: hermanos[index].nombre,
          libro: libro,
          capitulo: capitulo,
          porcentaje: porcentaje
        }),
        headers: { "Content-Type": "application/json" }
      }).then(r => r.text())
        .then(resp => console.log("Servidor respondiÃ³:", resp))
        .catch(err => console.error("Error:", err));
    }

    function calcularCapitulosLeidos(libro, capitulo) {
      let count = 0;
      for (let l in libros) {
        if (l === libro) {
          count += capitulo;
          break;
        } else {
          count += libros[l];
        }
      }
      return count;
    }

    function calcularProgreso(libro, capitulo) {
      let leidos = calcularCapitulosLeidos(libro, capitulo);
      return { porcentaje: ((leidos / totalCapitulos) * 100).toFixed(2), leidos };
    }

    function renderHermanos() {
      const list = document.getElementById("hermanosList");
      let html = "";
      hermanos.forEach((h, index) => {
        const { porcentaje, leidos } = calcularProgreso(h.libro, h.capitulo);
        let opcionesLibros = "";
        for (let l in libros) {
          opcionesLibros += `<option value="${l}" ${h.libro === l ? "selected" : ""}>${l}</option>`;
        }
        let maxCap = libros[h.libro];
        html += `
          <div class="hermano">
            <h3>${h.nombre}</h3>
            <label>Libro leÃ­do:</label>
            <select id="libro-${index}" onchange="actualizarCapitulos(${index})">${opcionesLibros}</select>
            <label>CapÃ­tulo leÃ­do:</label>
            <input type="number" id="capitulo-${index}" value="${h.capitulo}" min="1" max="${maxCap}">
            <button class="save-btn" onclick="guardarProgreso(${index})">ðŸ’¾ Guardar</button>
            <button class="delete-btn" onclick="eliminarHermano(${index})">ðŸ—‘ Eliminar</button>
            <div class="progress-container">
              <div class="progress-bar"><div class="progress-fill" style="width:${porcentaje}%"></div></div>
              <p>Progreso: ${porcentaje}% (${leidos}/${totalCapitulos} capÃ­tulos)</p>
            </div>
          </div>
        `;
      });
      list.innerHTML = html;
    }

    function actualizarCapitulos(index) {
      const libro = document.getElementById(`libro-${index}`).value;
      const inputCap = document.getElementById(`capitulo-${index}`);
      inputCap.max = libros[libro];
      if (parseInt(inputCap.value) > libros[libro]) {
        inputCap.value = libros[libro];
      }
    }

    document.getElementById("nombreHermano").addEventListener("keypress", function(e) {
      if (e.key === "Enter") { agregarHermano(); }
    });

    renderHermanos();
  </script>
</body>
</html>
